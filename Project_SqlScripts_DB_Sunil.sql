CREATE TABLE PRODUCT_CATEGORY (
	CATEGORY_ID INT PRIMARY KEY,
	CATEGORY_NAME VARCHAR(30) NOT NULL,
	DECRIPTION TEXT,
	CREATED_AT TIMESTAMP,
	MODIFIED_AT TIMESTAMP,
	DELETED_AT TIMESTAMP
);


CREATE TABLE PRODUCT_INVENTORY (
	INVENTORY_ID INT PRIMARY KEY,
	QUANTITY INT,
	CREATED_AT TIMESTAMP,
	MODIFIED_AT TIMESTAMP,
	DELETED_AT TIMESTAMP
);


 CREATE TABLE DISCOUNT (
	DISCOUNT_ID INT PRIMARY KEY,
	DISCOUNT_NAME VARCHAR(50),
	DESCRIPTION TEXT,
	DISCOUNT_PERCENT NUMERIC(10, 5),
	ACTIVE BOOLEAN,
	CREATED_AT TIMESTAMP,
	MODIFIED_AT TIMESTAMP,
	DELETED_AT TIMESTAMP
);




 CREATE TABLE PRODUCT (
	PRODUCT_ID INT PRIMARY KEY,
	PRODUCT_NAME VARCHAR(100) NOT NULL,
	DESCRIPTION TEXT,
	PRICE NUMERIC(10, 5),
	CREATED_AT TIMESTAMP,
	MODIFIED_AT TIMESTAMP,
	DELETED_AT TIMESTAMP,
	DISCOUNT_ID INT,
	INVENTORY_ID INT,
	CATEGORY_ID INT,
	FOREIGN KEY (DISCOUNT_ID) REFERENCES DISCOUNT(DISCOUNT_ID),
	FOREIGN KEY (INVENTORY_ID) REFERENCES PRODUCT_INVENTORY(INVENTORY_ID),
	FOREIGN KEY (CATEGORY_ID) REFERENCES PRODUCT_CATEGORY(CATEGORY_ID)
	);

ALTER TABLE PRODUCT
ADD COST_PRICE NUMERIC(10,5);
CREATE TABLE USERS (
	USER_ID INT PRIMARY KEY, 
	USERNAME VARCHAR(40) NOT NULL, 
	USER_PASSWORD TEXT(20) NOT NULL, 
	FIRST_NAME VARCHAR(20) NOT NULL, 
	LAST_NAME VARCHAR(20) NOT NULL, 
	TELEPHONE INT, 
	CREATED_AT TIMESTAMP, 
	MODIFIED_AT TIMESTAMP
);

ALTER TABLE USERS
modify COLUMN TELEPHONE DOUBLE;



CREATE TABLE USERS_ADDRESS (
	USER_ADDRESS_ID INT(2) PRIMARY KEY,
	ADDRESS_LINE1 VARCHAR(50) NOT NULL,
	ADDRESS_LINE2 VARCHAR(50) NULL,
	CITY VARCHAR(20) NULL,
	POSTAL_CODE VARCHAR(6) NOT NULL,
	COUNTRY VARCHAR(20) NOT NULL,
	TELEPHONE VARCHAR(13),
	MOBILE VARCHAR(12),
	USER_ID INT,
	FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID)
);



CREATE TABLE USERS_PAYMENT (
	USER_PAYMENT_ID INT PRIMARY KEY,
	PAYMENT_TYPE VARCHAR(15),
	PROVIDER VARCHAR(20),
	ACCOUNT_NO INT(12),
	EXPIRY DATE,
	USER_ID INT,
	FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID)
	);
ALTER TABLE USERS_PAYMENT
modify COLUMN ACCOUNT_NO DOUBLE;



CREATE TABLE SHOPPING_SESSION (
	SESSION_ID INT PRIMARY KEY,
	TOTAL NUMERIC(10, 2),
	CREATED_AT TIMESTAMP,
	MODIFIED_AT TIMESTAMP,
	USER_ID INT,
	FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID)
);



CREATE TABLE CART_ITEM (
	CART_ITEM_ID INT PRIMARY KEY,
	QUANTITY INT,
	CREATED_AT TIMESTAMP,
	MODIFIED_AT TIMESTAMP,
	SESSION_ID INT,
	PRODUCT_ID INT,
	FOREIGN KEY (SESSION_ID) REFERENCES SHOPPING_SESSION (SESSION_ID),
	FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT (PRODUCT_ID)
);


CREATE TABLE PAYMENT_DETAILS (
	PAYMENT_ID INT PRIMARY KEY,
	ORDER_ID INT,
	AMOUNT INT,
	PROVIDER VARCHAR(20),
	PAYMENT_STATUS VARCHAR(20),
	CREATED_AT TIMESTAMP,
	MODIFIED_AT TIMESTAMP
	);
ALTER TABLE PAYMENT_DETAILS
MODIFY COLUMN AMOUNT NUMERIC(6,2);


CREATE TABLE ORDER_DETAILS (
	ORDER_ID INT PRIMARY KEY,
	TOTAL NUMERIC(10, 4),
	CREATED_AT TIMESTAMP,
	MODIFIED_AT TIMESTAMP,
	PAYMENT_ID INT,
	USER_ID INT,
	FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID),
	FOREIGN KEY (PAYMENT_ID) REFERENCES PAYMENT_DETAILS(PAYMENT_ID)
	);


CREATE TABLE ORDER_ITEMS (
	ORDER_ITEMS_ID INT PRIMARY KEY,
	QUANTITY INT,
	CREATED_AT TIMESTAMP,
	MODIFIED_AT TIMESTAMP,
	ORDER_ID INT,
	PRODUCT_ID INT
);




#INSERTING DATA INTO THE TABLES, MINIMUM 10-15 RECORDS. 

-- inserting data into the PRODUCT_CATEGORY
 INSERT INTO PRODUCT_CATEGORY
VALUES(01,"CLOTHING","Shop for Clothing to Find Mens, Womens, Juniors and Childrens Clothing. Save money. Live better.",'2010-01-01 06:00:00','2022-11-01 19:23:47',NULL);
 INSERT INTO PRODUCT_CATEGORY
VALUES(02, "ELECTRONICS", " Shop for Electronics for the best selection of electronics at Every Day Low Prices. Save Money, Live Better.", '2010-01-01 06:00:00', '2022-11-01 19:28:27', NULL);
 INSERT INTO PRODUCT_CATEGORY
VALUES(03, "FOOD & BEVERAGES", "From water and juice to coffee, beer and wine, you'll find a wide variety of delicious and refreshing beverages, all at Every Day Low Prices.", '2010-01-01 06:00:00', '2022-11-01 19:30:17', NULL);
 INSERT INTO PRODUCT_CATEGORY
VALUES(04, "FOOTWEAR", "Discover the latest styles of brand name shoes & accessories for Men, Women & Kids.", '2010-01-01 06:00:00', '2022-11-01 19:31:47', NULL);
 INSERT INTO PRODUCT_CATEGORY
VALUES (05, "FURNITURE", "Living room ideas! Discover furniture, decor, & living room decorating tips. Free shipping on orders over $35 and free pickup today", '2010-01-01 06:00:00', '2022-11-01 19:32:27', NULL);
INSERT INTO PRODUCT_CATEGORY
VALUES(06, "HOME", "Shop Home Appliances, Home Decor, Cookware & More!", '2010-01-01 06:00:00', '2022-11-01 19:34:27', NULL);
INSERT INTO PRODUCT_CATEGORY
 VALUES(07, "HEALTH & BEAUTY", "Shop for all beauty products. Browse for makeup, skin care, fragrances, oral care, grooming, and hair care.", '2010-01-01 06:00:00', '2022-11-01 19:35:27', NULL);
INSERT INTO PRODUCT_CATEGORY
VALUES (08, "JEWELRY", "Shop for All in Stock Womens Jewelry in Womens Jewelry & Watches", '2010-01-01 06:00:00', '2022-11-01 19:36:27', NULL);
INSERT INTO PRODUCT_CATEGORY
VALUES (09, "MEDIA", "Rich Media Content for Marketplace Listings Loading like movies,music and TV shows..etc.", '2010-01-01 06:00:00', '2022-11-01 19:37:27', NULL);
INSERT INTO PRODUCT_CATEGORY
 VALUES(10, "VECHILE", "Shop Auto and browse Auto Parts, Tires, Exterior, and Interior Car Accessories..etc..", '2010-01-01 06:00:00', '2022-11-01 19:38:27', NULL);
COMMIT;



SELECT * from PRODUCT_CATEGORY;


-- inserting data into the PRODUCT_INVENTORY
INSERT INTO PRODUCT_INVENTORY
VALUES (101,3,'2010-01-01 06:00:00','2022-11-01 19:23:47',NULL),
		(102,6,'2010-01-01 06:00:00','2022-11-01 19:23:47',NULL),
		(103,6,'2010-01-01 06:00:00','2022-11-01 19:23:47',NULL),
		(104,5,'2010-01-01 06:00:00','2022-11-01 19:23:47',NULL),
		(105,3,'2010-01-01 06:00:00','2022-11-01 19:23:47',NULL),
		(106,5,'2010-01-01 06:00:00','2022-11-01 19:23:47',NULL),
		(107,4,'2010-01-01 06:00:00','2022-11-01 19:23:47',NULL),
		(108,4,'2010-01-01 06:00:00','2022-11-01 19:23:47',NULL),
		(109,6,'2010-01-01 06:00:00','2022-11-01 19:23:47',NULL),
		(110,4,'2010-01-01 06:00:00','2022-11-01 19:23:47',NULL);

SELECT * from PRODUCT_INVENTORY;


-- inserting data into DISCOUNT
INSERT INTO DISCOUNT(DISCOUNT_ID,DISCOUNT_NAME,DESCRIPTION,DISCOUNT_PERCENT,ACTIVE,CREATED_AT,MODIFIED_AT)
VALUES 
(1,"No discount","sorry, no discount on this product",0.00,TRUE,'2010-01-01 06:00:00','2022-11-01 19:23:47'),
(2,"10 percent offer","congrats you got  10% discount on this product",10.00,TRUE,'2010-01-01 06:00:00','2022-11-01 19:23:47'),
(3,"20 percent offer","congrats you got  20% discount on this product",20.00,TRUE,'2010-01-01 06:00:00','2022-11-01 19:23:47'),
(4,"30 percent offer","congrats you got  30% discount on this product",30.00,TRUE,'2010-01-01 06:00:00','2022-11-01 19:23:47'),
(5,"40 percent offer","congrats you got  40% discount on this product",40.00,TRUE,'2010-01-01 06:00:00','2022-11-01 19:23:47'),
(6,"50 percent offer","congrats you got  50% discount on this product",50.00,TRUE,'2010-01-01 06:00:00','2022-11-01 19:23:47');

SELECT * from DISCOUNT;



-- inserting data into products;
;
INSERT into PRODUCT(PRODUCT_ID,Cost_price,PRODUCT_NAME,DESCRIPTION,PRICE,CREATED_AT,MODIFIED_AT,DELETED_AT,DISCOUNT_ID,INVENTORY_ID,CATEGORY_ID)
VALUES
(1000,1189.00000,"IPHONE-13PRO","THIS IS A NEW IPHONE MODEL 13PRO BY APPLE",1300,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,2,102,2),
(1001,240.00000,"AIRPODS-PRO","THIS IS A BRAND NEW WIRELESS AIRPODS BY APPLE.INC",260,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,102,2),
(1002,550.00000,"SONY-I3_SPEAKERS","QUALITY MATTERS IN MUSIC, INTRODUSING NEW SONY SPEAKERS",650,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,2,102,2),
(1003,45.00000,"RAYMOND-JEANS","THE JEANS THAT TELLS YOUR STYLE..THAT'S RAYMOND",50,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,101,1),
(1004,61.00000,"ADDIDAS_SWEATER","THE BRAND NEW WWEATER THAT KEEPS YOU COOL",65,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,2,101,1),
(1005,40.00000,"NIKE_T-SHIRT","WHEN SUMMER, ITS FOR NIKE T-SHIRT FOR COMFORT",43,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,4,101,1),
(1006,12.90000,"REDBULL_500ML","THE DRINK THAT KEEPS YOUR ENERGY FOR LONG TIME",14,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,103,3),
(1007,22.87000,"GRAPE_WINE","THE MORE COLD,THE MORE WINE WILL KEEPS YOU NORMAL",25,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,103,3),
(1008,9.80000,"KINGS_BREAD","THE FOOD FOR ALL IS BREAD",10,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,103,3),
(1009,178.00000,"NIKE_SHOES","FOR BETTER RUN",190,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,4,104,4),
(1010,290.00000,"REEBOK_SHOES","THE KNOWN FOR SHOPRT OF MARATHON",320,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,2,104,4),
(1011,63.00000,"PUMA_SLIPPERS","THE BEST OF BEST COMFORT FOR CASUAL WALK",70,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,104,4),
(1012,401.00000,"WOMEN_SANDALS","MORE WOMEN LIKE BEING FASHION, THATS WHAT OUR SANDALS",433,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,5,104,4),
(1013,192.00000,"WODDEN_TABLE","THE BEST OF FURNITURE THAT IS IN YOUR HOME",210,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,2,105,5),
(1014,169.00000,"BOOKCASE","LETS PUT ALL BOOKS AT ONE PLACE",180,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,105,5),
(1015,120.79000,"BEDS","THE NEW SPONGE THAT MAKES YOU SLEEP GOOD",130,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,2,105,5),
(1016,188.00000,"SAMSUNG_AC", "AIR_CONDITIONER THAT KEEPS YOUR ROOM MORE COOLER",209,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,106,6),
(1017,111.60000,"ART_PRINT","LETS WAKEUP THE AIRTIST IN YOU ON ART_PRINT",121,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,106,6),
(1018,91.43000,"LARGE_MIRROR","THE HAPPPY FACE LOOKS MIRROR FOR MORE GLOW",99,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,106,6),
(1019,27.23000,"COLGATE_TOOTHPASTE","KEEP TEETH STRONG WITH THE NEW COLGATE SALT PASTE",29,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,2,106,6),
(1020,12.40000,"NKD_ELECTRIC_RAZOR","THE MORE FLEXIBLE AND LONG LASTING",17,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,2,106,6),
(1021,26.00000,"HAIR_DRYER","THE WET HAIR WENT IN SECONDS WITH NEW HAIR_DRYER",30,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,106,6),
(1022,9.10000,"Hand_Soap","Best smelling hand soap EO French Lavender Hand Soap.",10,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,107,7),
(1023,7.89000,"Hand Sanitizer","keep your hands clean and safe",9,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,107,7),
(1024,41.99000,"Blood pressure monitors","now check your bp at home with this device everyday",45,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,2,107,7),
(1025,20.99000,"Thermometers","check our body temparature in home",23,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,107,7),
(1026,81.23000,"Earring","Cate & Chloe Norah 18k White Gold Stud Earrings with Cubic design",89,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,108,8),
(1027,191.89000,"Bracelate","This bracelet features 70 rose cut diamonds in J-K color, I2-I3 clarity",199,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,3,108,8),
(1028,32.65000,"Taylor Swift - Midnights","it’s a collection of music written in the middle of the night, a journey through terrors and sweet dreams",39,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,1,109,9),
(1029,43.99000,"Pokemon Violet","The newest chapters in the Pokémon series, the Pokemon Scarlet and Pokémon Violet games, are released to the Nintendo Switch system later this year.",52,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,2,109,9),
(1030,58.43000,"Synthetic Motor Oil","Utilizes Mobil 1’s signature Triple Action Formula to deliver outstanding engine performance, protection, and cleanliness to vehicles of all ages.",65,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,4,110,10),
(1031,28.54000,"Car Cleaning Product","Customize the look of your Model 3 or Model Y's scratch-prone center console with this professionally designed center console wrap kit.",31,'2021-11-05 05:20:00','2022-11-01 19:23:47',NULL,3,110,10);

SELECT * FROM PRODUCT;


INSERT INTO USERS (USER_ID,USERNAME,USER_PASSWORD,FIRST_NAME,LAST_NAME,TELEPHONE,CREATED_AT,MODIFIED_AT)
VALUES (10001,'MAHI','Mahesh123','mahesh','babu',9010901087,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10002,'tarak','Tarak123','tarak','ram',8978675645,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10003,'Nagaraj','Nag1234','naga','raju',9897969594,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10004,'krish','Krishna098','krishna','raju',3476289710,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10005,'raghu','Raghu765','raghu','ram',7648737652,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10006,'adhi','Adhi059','Adhi','kesav',4637289283,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10007,'vijay','vijay768','Vijay','Mohan',5656476387,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10008,'Naveen','Naveen990','NaveenK','killer',9089786732,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10009,'Tasha','Uhiltr12','Tasha','Sarita',6776789770,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10010,'Ravi','raviuy','ravi','teja',8778900965,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10011,'elonm','mush2334','elon','musk',5664798878,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10012,'miriya','jones768','miriya','joanes',7664563737,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10013,'scoot','field435','scoott','field',8998655670,'2021-11-05 05:20:00','2022-11-01 19:23:47'),
(10014,'steve','jobs2332','steve','jobs',7667890912,'2021-11-05 05:20:00','2022-11-01 19:23:47');

SELECT * FROM USERS;

INSERT INTO USERS_ADDRESS(USER_ADDRESS_ID,user_id,address_line1, address_line2,city,POSTAL_CODE,country,telephone,mobile)
VALUES (1,10001,'old westport road','dartmouth','North dartmouth',02747,'USA',9010901087,NULL),
(2,10001,'regency','new gaolin st','New bedford',02747,'USA',9010901087,NULL),
(3,10002,'house no 22d','wallnick st','hiddenbrooks',02678,'USA',8978675645,NULL),
(4,10003,'Baker Blvd','Eugene','jersey',97403,'USA',9897969594,NULL),
(5,10004,'City Center Plaza','516 Main St','Elgin',97827,'USA',3476289710,NULL),
(6,10005,'Maubelstr', '90Brandenburg','medison',14776,'USA',7648737652,NULL),
(7,10006,'87 Polk St', 'Suite 5','San Francisco',94117,'USA',4637289283,NULL),
(8,10007,'89 Chiaroscuro Rd','main street','Portland',97219,'USA',5656476387,NULL),
(9,10008,'722 DaVinci Blvd','beside bofa','Kirkland',98034,'USA',9089786732,NULL),
(10,10009,'305 - 14th Ave', 'S. Suite 3B','Seattle',98128,'USA',6776789770,NULL),
(11,10010,'2103 pickens way','near dunkin','Dallas',75207,'USA',8778900965,NULL), 
(12,10010,'43 Eagle drive','southfield','troy',48075,'USA',8778900965,NULL),
(13,10011,'2576 bel meadow drive','old street','chino',91710,'USA',5664798878,NULL),
(14,10012,'233 hampton meadows','Bedford','new bedford',01730,'USA',7664563737,NULL),
(15,10012,'2623 berkley street','main circle','philadelphia',19108,'USA',7664563737,NULL),
(16,10013,'1088 fairfax drive','lowalelll street','mingo',50168,'USA',8998655670,NULL),
(17,10014,'robert robertson','1234nw bobcat lane','ST.Robert',65584,'USA',7667890912,NULL),
(18,10014,'1683 hillhaven drive','mairile st','irvine',92614,'USA',7667890912,NULL);

SELECT * FROM USERS_ADDRESS;



INSERT INTO USERS_PAYMENT(USER_PAYMENT_ID,USER_ID,PAYMENT_TYPE,PROVIDER,ACCOUNT_NO,EXPIRY)
VALUES (1287998,10001,"Credit","VISA",02045678901,"2027/11/30"),
(1287948,10002,"credit","mastercard",02034487643,"2028/10/31"),
(1282998,10003,"debit","visa",02045584564,"2027/09/30"),
(1287298,10004,"paypal",NULL,02048970987,"2026/12/31"),
(1257998,10005,"credit","VISA",02657837908,"2028/09/30"),
(1287398,10006,"debit","mastercard",02768976309,"2027/03/31"),
(1287933,10007,"credit","mastercard",02037879564,"2029/10/31"),
(1287208,10008,"debit","visa",0203025674890,"2025/03/31"),
(1288098,10009,"credit","mastercard",02086758432,"2026/08/31"),
(1297998,10010,"paypal",NULL,02076578452,"2027/11/30"),
(1287498,10011,"paypal",NULL,02796778641,"2024/05/31"),
(1287908,10012,"credit","visa",02676483892,"2025/12/31"),
(1288998,10013,"credit","mastercard",02456845900,"2027/01/31"),
(1209998,10014,"paypal",NULL,02897464910,"2026/10/31"),
(1287997,10006,"credit","visa",02734893020,"2028/11/30");

SELECT * FROM USERS_PAYMENT;




INSERT INTO SHOPPING_SESSION(SESSION_ID,USER_ID,TOTAL,CREATED_AT,MODIFIED_AT)
VALUES (1123,10001,560.00,'2021-11-05 05:20:00','2021-11-05 05:28:00'),
(1872,10002,870.23,'2022-11-29 07:10:00','2022-11-29 07:22:50'),
(1129,10003,490.65,'2022-11-30 11:30:00','2022-11-30 11:37:17'),
(1332,10004,523.89,'2022-11-23 11:47:00','2022-11-23 11:53:53'),
(1009,10005,209.20,'2022-11-27 12:22:00','2022-11-27 12:32:30'),
(1334,10006,390.32,'2022-11-28 01:20:00','2022-11-28 01:24:40'),
(1142,10009,439.98,'2022-11-25 04:33:00','2022-11-25 04:35:00'),
(1223,10011,129.87,'2022-11-20 11:30:00','2022-11-20 11:31:00'),
(1190,10008,320.32,'2022-11-24 14:22:34','2022-11-24 14:26:50'),
(1443,10007,540.65,'2022-11-30 11:45:00','2022-11-30 11:53:00'),
(1212,10010,340.45,'2022-11-29 07:40:00','2022-11-29 07:45:00'),
(1330,10012,667.09,'2022-11-27 12:21:50','2022-11-27 12:29:06'),
(1532,10014,453.06,'2022-11-26 13:30:56','2022-11-26 13:36:34'),
(1189,10003,764.34,'2022-11-28 14:35:00','2022-11-28 14:45:30'),
(1354,10011,435.09,'2022-11-23 10:34:00','2022-11-23 10:41:04'),
(1218,10013,654.81,'2022-11-21 09:23:06','2022-11-21 11:40:00'),
(1765,10006,548.39,'2022-11-22 08:39:04','2022-11-22 10:21:00'),
(1344,10002,650.89,'2022-11-25 01:39:24','2022-11-25 01:48:44'),
(1645,10010,487.35,'2022-11-30 11:54:00','2022-11-30 12:01:43'),
(1423,10003,398.95,'2022-11-20 16:31:00','2022-11-20 16:36:00'),
(1209,10007,560.89,'2022-11-24 15:23:00','2022-11-24 15:31:00'),
(1049,10009,746.00,'2022-11-27 14:39:00','2022-11-27 14:49:00');

SELECT * FROM SHOPPING_SESSION;



INSERT INTO CART_ITEM(CART_ITEM_ID,SESSION_ID,PRODUCT_ID,QUANTITY,CREATED_AT,MODIFIED_AT)
VALUES (870009,1123,1001,1,'2021-11-05 05:20:00','2021-11-05 05:28:00'),
(870029,1423,1009,2,'2022-11-29 07:10:00','2022-11-29 07:22:50'),
(870010,1344,1006,3,'2022-11-28 01:20:00','2022-11-28 01:24:40'),
(870023,1872,1010,1,'2022-11-29 07:10:00','2022-11-29 07:22:50'),
(870043,1129,1020,4,'2022-11-30 11:30:00','2022-11-30 11:37:17'),
(870034,1189,1010,3,'2022-11-28 14:35:00','2022-11-28 14:45:30'),
(870006,1423,1023,1,'2022-11-20 16:31:00','2022-11-20 16:36:00'),
(870021,1332,1028,2,'2022-11-23 11:47:00','2022-11-23 11:53:53'),
(870007,1009,1030,1,'2022-11-27 12:22:00','2022-11-27 12:32:30'),
(870002,1334,1002,3,'2022-11-28 01:20:00','2022-11-28 01:24:40'),
(870027,1765,1005,2,'2022-11-22 08:39:04','2022-11-22 10:21:00'),
(870032,1209,1028,3,'2022-11-24 15:23:00','2022-11-24 15:31:00'),
(870031,1443,1005,1,'2022-11-30 11:45:00','2022-11-30 11:53:00'),
(870041,1190,1029,4,'2022-11-24 14:22:34','2022-11-24 14:26:50'),
(870030,1049,1024,1,'2022-11-27 14:39:00','2022-11-27 14:49:00'),
(870038,1142,1000,1,'2022-11-25 04:33:00','2022-11-25 04:35:00'),
(870018,1212,1012,5,'2022-11-29 07:40:00','2022-11-29 07:45:00'),
(870014,1645,1021,3,'2022-11-30 11:54:00','2022-11-30 12:01:43'),
(870024,1223,1007,1,'2022-11-20 11:30:00','2022-11-20 11:31:00'),
(870039,1354,1019,2,'2022-11-23 10:34:00','2022-11-23 10:41:04'),
(870012,1330,1021,2,'2022-11-27 12:21:50','2022-11-27 12:29:06'),
(870069,1218,1031,4,'2022-11-21 09:23:06','2022-11-21 11:40:00'),
(870053,1344,1010,1,'2022-11-28 01:20:00','2022-11-28 01:24:40'),
(870056,1212,1011,3,'2022-11-29 07:40:00','2022-11-29 07:45:00'),
(870013,1049,1021,1,'2022-11-27 14:39:00','2022-11-27 14:49:00'),
(870016,1443,1029,2,'2022-11-30 11:45:00','2022-11-30 11:53:00'),
(870000,1532,1015,1,'2022-11-26 13:30:56','2022-11-26 13:36:34');

SELECT * FROM CART_ITEM;







INSERT INTO ORDER_DETAILS(ORDER_ID,USER_ID,TOTAL,PAYMENT_ID,CREATED_AT,MODIFIED_AT)
VALUES (123000,10002,29.43,000123,'2021-11-05 05:27:00',NULL),
(123001,10004,34.98,000124,'2022-11-26 13:36:34',NULL),
(123002,10007,98.32,000125,'2022-11-28 01:24:40',NULL),
(123003,10009,71.90,000126,'2022-11-20 16:36:00',NULL),
(123004,10002,120.32,000127,'2022-11-27 12:32:30',NULL),
(123005,10001,231.34,000128,'2022-11-05 05:28:00',NULL),
(123006,10014,139.12,000129,'2022-11-28 01:24:40',NULL),
(123007,10012,233.90,000130,'2022-11-27 12:29:06',NULL),
(123008,10011,543.12,000131,'2022-11-27 14:49:00',NULL),
(123009,10010,230.32,000132,'2022-11-30 12:01:43',NULL),
(123010,10009,109.29,000133,'2022-11-30 11:53:00',NULL),
(123011,10004,439.11,000134,'2022-11-29 07:45:00',NULL),
(123012,10010,310.10,000135,'2022-11-23 11:53:53',NULL),
(123013,10007,87.57,000136,'2022-11-29 07:22:50',NULL),
(123014,10012,49.34,000137,'2022-11-20 11:31:00',NULL),
(123015,10011,86.34,000138,'2022-11-22 10:21:00',NULL),
(123016,10009,9.34,000139,'2022-11-29 07:22:50',NULL),
(123017,10014,23.99,000140,'2022-11-27 14:49:00',NULL),
(123018,10001,74.39,000141,'2022-11-30 11:53:00',NULL),
(123019,10009,130.78,000142,'2022-11-24 15:31:00',NULL),
(123020,10014,210.32,000143,'2022-11-28 14:45:30',NULL),
(123021,10002,339.89,000144,'2022-11-25 04:35:00',NULL),
(123022,10011,30.46,000145,'2022-11-23 10:41:04',NULL),
(123023,10012,205.43,000146,'2022-11-24 14:26:50',NULL),
(123024,10002,221.23,000147,'2022-11-30 11:37:17',NULL),
(123025,10014,99.23,000148,'2022-11-28 01:24:40',NULL),
(123026,10001,173.99,000149,'2022-11-29 07:45:00',NULL),
(123027,10007,48.32,000150,'2022-11-21 11:40:00',NULL),
(123028,10012,30.98,000151,'2022-11-23 17:31:00',NULL);

SELECT * FROM  ORDER_DETAILS;





INSERT INTO ORDER_ITEMS(ORDER_ITEMS_ID,ORDER_ID,QUANTITY,PRODUCT_ID,CREATED_AT,MODIFIED_AT)
VALUES (876001,123000,1,1019,'2021-11-05 05:27:00',NULL),
(876002,123001,1,1008,'2022-11-26 13:36:34',NULL),
(876003,123001,1,1025,'2022-11-26 13:36:34',NULL),
(876004,123002,1,1030,'2022-11-28 01:24:40',NULL),
(876005,123002,1,1031,'2022-11-28 01:24:40',NULL),
(876006,123003,1,1011,'2022-11-20 16:36:00',NULL),
(876007,123004,1,1015,'2022-11-27 12:32:30',NULL),
(876008,123005,2,1003,'2022-11-05 05:28:00',NULL),
(876009,123005,1,1015,'2022-11-05 05:28:00',NULL),
(876010,123006,1,1026,'2022-11-28 01:24:40',NULL),
(876011,123006,2,1007,'2022-11-28 01:24:40',NULL),
(876012,123007,1,1016,'2022-11-27 12:29:06',NULL),
(876013,123007,1,1006,'2022-11-27 12:29:06',NULL),
(876014,123008,2,1016,'2022-11-27 14:49:00',NULL),
(876015,123008,1,1017,'2022-11-27 14:49:00',NULL),
(876016,123009,1,1016,'2022-11-30 12:01:43',NULL),
(876017,123009,2,1008,'2022-11-30 12:01:43',NULL),
(876018,123010,1,1018,'2022-11-30 11:53:00',NULL),
(876019,123010,1,1023,'2022-11-30 11:53:00',NULL),
(876020,123011,2,1027,'2022-11-29 07:45:00',NULL),
(876021,123011,1,1017,'2022-11-29 07:45:00',NULL),
(876022,123012,1,1001,'2022-11-23 11:53:53',NULL),
(876023,123012,1,1003,'2022-11-23 11:53:53',NULL),
(876024,123013,6,1006,'2022-11-29 07:22:50',NULL),
(876025,123014,2,1025,'2022-11-20 11:31:00',NULL),
(876026,123015,3,1007,'2022-11-22 10:21:00',NULL),
(876027,123015,1,1006,'2022-11-22 10:21:00',NULL),
(876028,123016,1,1023,'2022-11-29 07:22:50',NULL),
(876029,123017,1,1025,'2022-11-27 14:49:00',NULL),
(876030,123018,3,1025,'2022-11-30 11:53:00',NULL),
(876031,123019,1,1017,'2022-11-24 15:31:00',NULL),
(876032,123019,1,1023,'2022-11-24 15:31:00',NULL),
(876033,123020,3,1011,'2022-11-28 14:45:30',NULL),
(876034,123021,2,1027,'2022-11-25 04:35:00',NULL),
(876035,123021,2,1022,'2022-11-25 04:35:00',NULL),
(876036,123022,1,1021,'2022-11-23 10:41:04',NULL),
(876037,123023,5,1028,'2022-11-24 14:26:50',NULL),
(876038,123024,3,1011,'2022-11-30 11:37:17',NULL),
(876039,123024,1,1023,'2022-11-30 11:37:17',NULL),
(876040,123025,1,1018,'2022-11-28 01:24:40',NULL),
(876041,123026,6,1005,'2022-11-29 07:45:00',NULL),
(876042,123027,2,1019,'2022-11-21 11:40:00',NULL),
(876043,123028,3,1022,'2022-11-23 17:31:00',NULL);

SELECT * FROM ORDER_ITEMS;






INSERT INTO PAYMENT_DETAILS(PAYMENT_ID,ORDER_ID,AMOUNT,PROVIDER,PAYMENT_STATUS,CREATED_AT,MODIFIED_AT)
VALUES (000123,123000,29.43,"VISA","Completed",'2021-11-05 05:27:00',NULL),
(000124,123001,34.98,"MASTERCARD","COMPLETED",'2022-11-26 13:36:34',NULL),
(000125,123002,98.32,"PAYPAL","COMPLETED",'2022-11-28 01:24:40',NULL),
(000126,123003,71.90,"MASTERCARD","COMPLETED",'2022-11-20 16:36:00',NULL),
(000127,123004,120.32,"MASTERCARD","COMPLETED",'2022-11-27 12:32:30',NULL),
(000128,123005,231.34,"VISA","COMPLETED",'2022-11-05 05:28:00',NULL),
(000129,123006,139.12,"VISA","COMPLETED",'2022-11-28 01:24:40',NULL),
(000130,123007,233.90,"PAYPAL","NOTCOMPLETED",'2022-11-27 12:29:06',NULL),
(000131,123008,543.12,"PAYPAL","COMPLETED",'2022-11-27 14:49:00',NULL),
(000132,123009,230.32,"VISA","COMPLETED",'2022-11-30 12:01:43',NULL),
(000133,123010,109.29,"VISA","COMPLETED",'2022-11-30 11:53:00',NULL),
(000134,123011,439.11,"MASTERCARD","COMPLETED",'2022-11-29 07:45:00',NULL),
(000135,123012,310.10,"MASTERCARD","COMPLETED",'2022-11-23 11:53:53',NULL),
(000136,123013,87.57,"VISA","COMPLETED",'2022-11-29 07:22:50',NULL),
(000137,123014,49.34,"VISA","NOTCOMPLETED",'2022-11-20 11:31:00',NULL),
(000138,123015,86.34,"PAYPAL","COMPLETED",'2022-11-22 10:21:00',NULL),
(000139,123016,09.34,"PAYPAL","COMPLETED",'2022-11-29 07:22:50',NULL),
(000140,123017,23.99,"VISA","COMPLETED",'2022-11-27 14:49:00',NULL),
(000141,123018,74.39,"VISA","COMPLETED",'2022-11-30 11:53:00',NULL),
(000142,123019,130.78,"MASTERCARD","COMPLETED",'2022-11-24 15:31:00',NULL),
(000143,123020,210.32,"MASTERCARD","COMPLETED",'2022-11-28 14:45:30',NULL),
(000144,123021,339.89,"MASTERCARD","COMPLETED",'2022-11-25 04:35:00',NULL),
(000145,123022,30.46,"VISA","NOTCOMPLETED",'2022-11-23 10:41:04',NULL),
(000146,123023,205.43,"VISA","COMPLETED",'2022-11-24 14:26:50',NULL),
(000147,123024,221.23,"PAYPAL","COMPLETED",'2022-11-30 11:37:17',NULL),
(000148,123025,99.23,"VISA","COMPLETED",'2022-11-28 01:24:40',NULL),
(000149,123026,173.99,"VISA","COMPLETED",'2022-11-29 07:45:00',NULL),
(000150,123027,48.32,"MASTERCARD","NOTCOMPLETED",'2022-11-21 11:40:00',NULL),
(000151,123028,30.98,"VISA","COMPLETED",'2022-11-23 17:31:00',NULL);

SELECT * FROM PAYMENT_DETAILS;


/*1) Top 5 selling products & product categories during Thanksgiving Season i.e from (11/23/2022 – 11/28/2022)*/

;
select * from (
select CATEGORY_ID, CATEGORY_NAME,PRODUCT_ID,PRODUCT_NAME,order_count, dense_rank() 
OVER ( partition by CATEGORY_ID order by order_count desc ) 
AS ct_rank from (
SELECT CT.CATEGORY_ID, CT.CATEGORY_NAME, PR.PRODUCT_ID, PR.PRODUCT_NAME, COUNT(DISTINCT ORDER_ITEMS_ID) AS order_count
from ORDER_ITEMS OT join PRODUCT PR 
on OT.PRODUCT_ID = PR.PRODUCT_ID
JOIN PRODUCT_CATEGORY CT
ON PR.CATEGORY_ID = CT.CATEGORY_ID
where OT.CREATED_AT BETWEEN '2022-11-23 00:00:00' AND '2022-11-28 00:00:00'
group by 1,2,3,4
ORDER BY 5 DESC,1
) as orders) as or_rank
where ct_rank = 1
order by order_count desc
limit 5;


/*2) Create a list of inventories available by product category and product level after the end of Thanksgiving Sales (To fill up for the Christmas season)*/

;
select CT.CATEGORY_ID, CT.CATEGORY_NAME, PR.PRODUCT_ID, PR.PRODUCT_NAME, SUM(INV.QUANTITY) as inventory
from PRODUCT_INVENTORY INV join PRODUCT PR ON INV.INVENTORY_ID = PR.INVENTORY_ID
join PRODUCT_CATEGORY CT on PR.CATEGORY_ID = CT.CATEGORY_ID
WHERE INV.DELETED_AT IS NULL
group by 1,2,3,4
Order by 5 desc, 1;

/*3) A query to calculate profit margin (Selling_price – (Cost_Price) – (Discount) ) for Top 10 Product categories and their products*/
;

select CATEGORY_NAME, PRODUCT_NAME, SUM(profit_margin) as margin from(
select CT.CATEGORY_NAME,P.PRODUCT_NAME,P.PRICE,P.COST_PRICE,(Price-COST_PRICE-(PRICE*(DISCOUNT_PERCENT/100))) AS profit_margin
from PRODUCT P JOIN DISCOUNT D
on P.DISCOUNT_ID = D.DISCOUNT_ID
JOIN PRODUCT_CATEGORY CT ON P.CATEGORY_ID = CT.CATEGORY_ID
) as profit
group by 1,2
order by 3 desc,1;


/*4) Top 3 Service Providers by Sales*/
;
select Provider, sum(AMOUNT) as sales
from PAYMENT_DETAILS
group by 1
order by 2
limit 3;


/*6) What is the average session time per user and Top customer with high session time*/
;
select U.USER_ID, U.USERNAME, CONCAT(U.FIRST_NAME, " ",U.LAST_NAME) AS NAME, (avg(SESS.TOTAL)/60) as avg_session_minutes, (sum(SESS.TOTAL)/60) as sum_session_minutes
from USERS U join SHOPPING_SESSION SESS
on U.USER_ID = SESS.USER_ID
group by 1,2,3
order by 5 desc;

/*7) Top products at user level (for top 100 customers) with high shopping session time but no product conversion*/
;
SELECT HIGH_SESS.USER_ID, CONCAT(U.FIRST_NAME," ",U.LAST_NAME) AS USER_NAME, HIGH_SESS.PRODUCT_ID, P.PRODUCT_NAME FROM
(select SESS.USER_ID, it.PRODUCT_ID, CONCAT(SESS.USER_ID,it.PRODUCT_ID) AS USER_PRODUCT, sum((SESS.TOTAL)/60) as sum_session_minutes
from SHOPPING_SESSION SESS join CART_ITEM it
ON SESS.SESSION_ID = it.session_id
group by 1,2,3
order by 3 DESC
limit 100) AS HIGH_SESS 
JOIN USERS U ON U.USER_ID = HIGH_SESS.USER_ID
JOIN PRODUCT P ON P.PRODUCT_ID = HIGH_SESS.PRODUCT_ID
WHERE USER_PRODUCT NOT IN (select DISTINCT concat(OD.USER_ID,OT.PRODUCT_ID) FROM ORDER_DETAILS OD JOIN ORDER_ITEMS OT ON OD.ORDER_ID = OT.ORDER_ID);


/* 8) Create a query to get the avg shopping sessions by cart value per customer*/
;
select U.USER_ID, U.USERNAME, CONCAT(U.FIRST_NAME, " ",U.LAST_NAME) AS NAME, (SUM(P.PRICE)/(SUM(SESS.TOTAL)/60)) SALES_PER_MINUTE
from USERS U join SHOPPING_SESSION SESS
on U.USER_ID = SESS.USER_ID
join CART_ITEM CT ON CT.SESSION_ID = SESS.SESSION_ID
JOIN PRODUCT P ON CT.PRODUCT_ID = P.PRODUCT_ID
GROUP BY 1,2,3 
order by 4 DESC;

/* 9) Create a query to get discount names and profit/loss generated for each discount */
;
select DISCOUNT_NAME, SUM(profit_margin) as margin from(
select D.DISCOUNT_NAME,(Price-COST_PRICE-(PRICE*(DISCOUNT_PERCENT/100))) AS profit_margin
from PRODUCT P JOIN DISCOUNT D
on P.DISCOUNT_ID = D.DISCOUNT_ID
) as profit
group by 1
order by 2 desc,1;

/* 10) Create a query to get customer Rank based on profit generated*/
;
SELECT CUST_NAME, margin,dense_rank() 
OVER (order by margin desc ) 
AS cust_rank from 
(select CONCAT(U.FIRST_NAME, " ",U.LAST_NAME) as CUST_NAME, SUM(profit_margin) as margin FROM
(select P.PRODUCT_ID,(Price-COST_PRICE-(PRICE*(DISCOUNT_PERCENT/100))) AS profit_margin
from PRODUCT P JOIN DISCOUNT D
on P.DISCOUNT_ID = D.DISCOUNT_ID
JOIN PRODUCT_CATEGORY CT ON P.CATEGORY_ID = CT.CATEGORY_ID) profit
JOIN ORDER_ITEMS OT ON OT.PRODUCT_ID = PROFIT.PRODUCT_ID
JOIN ORDER_DETAILS OD ON OT.ORDER_ID = OD.ORDER_ID
JOIN USERS U ON U.USER_ID = OD.USER_ID
group by 1
order by 2 DESC) as ra;






